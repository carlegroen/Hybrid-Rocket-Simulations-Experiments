% !TEX root = main.tex
%%%% Colour Palette %%%%%
\definecolor{black1}{RGB}{0,0,0}
\definecolor{orange1}{RGB}{230,159,0}
\definecolor{skyblue}{RGB}{86,180,233}
\definecolor{blueishgreen}{RGB}{0,158,115}
\definecolor{yellow}{RGB}{240,228,66}
\definecolor{blue1}{RGB}{0,114,178}
\definecolor{vermillion}{RGB}{213,94,0}
\definecolor{reddishpurple}{RGB}{204,121,167}
%%%%%% Block Styles %%%%%%%%%%%%%%%%%%%%%%%%%%%%
\tikzstyle{decision} = [diamond, draw, fill=blueishgreen,
    text width=4.5em, text badly centered, node distance=3cm, inner sep=0pt]
\tikzstyle{block} = [rectangle, draw, fill=skyblue,
    text width=5em, text centered, rounded corners, minimum height=4em]
\tikzstyle{line} = [draw, -latex']
\tikzstyle{cloud} = [draw, ellipse,fill=yellow, text width=5.5em, node distance=3.5cm,
    minimum height=2em]
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\chapter{Simulation}

The rocket's simulation can be explained relatively simply through a series of flowcharts. The first one describes how all constants and flows are defined, and how reference values are calculated.


\begin{tikzpicture}[node distance = 3cm, auto]
    % Place nodes
    \node [block] (const) {Define constants};
      \node [cloud, left of=const] (constvars) {$T_{amb}$, chamber dim., etc.};
    \node [block, below of=const] (inj) {Define injection rates per second};
      \node [cloud, left of=inj] (injvars) {$\dot{n}_{H_2O_2,1}$ $\dot{n}_{H_2O,1}$};
    \node [block, below of=inj] (dec) {Define decomposition rates per second};
      \node [cloud, left of=dec] (decvars) {$\dot{n}_{H_2O_2,2}$ $\dot{n}_{H_2O,2}$ $\dot{n}_{O_2,2}$};
    \node [block, below of=dec] (com) {Define combustion rates per second};
      \node [cloud, left of=com] (comvars) {$\dot{n}_{H_2O,3}$ $\dot{n}_{O_2,3}$ $\dot{n}_{CO_2,3}$};
    \node [block, below of=com] (exha) {Define exhaustion mass flow};
      \node [cloud, left of=exha] (exhavars) {$\dot{m}_{pla,3}$};
%%%% Defining more relavant stuff %%%%%
    \node [block, below of=exha] (mflow) {Define mass flow rates $n$ per timestep $dt$ to find enthalpy};
      \node [cloud, left of=mflow] (mflowvars) {$m_{tot,n} = \sum\limits_{\text{chem.} 1}^{\text{chem. k}} \dot{n}_j \cdot dt$};
    \node [block, right of=mflow] (mfrac) {Calculate mass fraction in flow rates to calculate enthalpy leaving rocket later};
    \node [block, above of=mfrac, node distance=6cm] (refent) {Calculate reference enthalpy in decomposition and combustion states};
      \node [cloud, right of=refent] (refentvars) {$H = \sum \dot{m}_{j} \cdot H_j(P,T) + \Delta h_{dec,com} \cdot \dot{m}_\chem{H_2O_2} \cdot dt$};
    \node [decision, right of=const, node distance=5cm] (next) {Passes static data into $P$ and $T$ calculations};


    % Draw edges
    \path [line] (const) -- (inj);
    \path [draw] (const) -- (constvars);
    \path [line] (inj) -- (dec);
    \path [draw] (inj) -- (injvars);
    \path [line] (dec) -- (com);
    \path [draw] (dec) -- (decvars);
    \path [line] (com) -- (exha);
    \path [draw] (com) -- (comvars);
    \path [draw] (exha) -- (exhavars);
    \path [line] (exha) -- (mflow);
    \path [draw] (mflow) -- (mflowvars);
    \path [line] (mflow) -- (mfrac);
    \path [line] (mfrac) -- (refent);
    \path [draw] (refent) -- (refentvars);
    \path [line] (refent) -- (next);
\end{tikzpicture}

INSERT FLOWCHATY OF SECONDARY PART WHEN POWERPOINT WORKS


% \begin{tikzpicture}[node distance = 2cm, auto]
%     % Place nodes
%     \node [block] (init) {initialize model};
%     \node [cloud, left of=init] (expert) {expert};
%     \node [cloud, right of=init] (system) {system};
%     \node [block, below of=init] (identify) {identify candidate models};
%     \node [block, below of=identify] (evaluate) {evaluate candidate models};
%     \node [block, left of=evaluate, node distance=3cm] (update) {update model};
%     \node [decision, below of=evaluate] (decide) {is best candidate better?};
%     \node [block, below of=decide, node distance=3cm] (stop) {stop};
%     % Draw edges
%     \path [line] (init) -- (identify);
%     \path [line] (identify) -- (evaluate);
%     \path [line] (evaluate) -- (decide);
%     \path [line] (decide) -| node [near start] {yes} (update);
%     \path [line] (update) |- (identify);
%     \path [line] (decide) -- node {no}(stop);
%     \path [line,dashed] (expert) -- (init);
%     \path [line,dashed] (system) -- (init);
%     \path [line,dashed] (system) |- (evaluate);
% \end{tikzpicture}
